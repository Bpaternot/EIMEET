<h1> <%= @tournament.user.username %>'s tournament</h1>
  <p>
    Organized by: <%= @tournament.user.username %><br>
    Date: <%= @tournament.date %><br>
    Bar's name: <%= @tournament.bar.name %><br>
    Tournament's type: <%= @tournament.tournament_type %><br>
    Total number of players: <%= @tournament.number_players %><br>
    Total number of remaining spots : <%= @remaining %><br>
    <% if @remaining_console_ps4 == 0 %>
      You have enough consoles to play the game!
    <% else %>
      Number of consoles still needed: <%= @remaining_console_ps4 %><br>
    <% end %>

    <% if @remaining_controllers == 0 %>
      You have enough controllers to play the game!
    <% else %>
      Number of controllers still needed: <%= @remaining_controllers %><br>
    <% end %>
  </p>



    <% if @remaining_fifa_game == 0 %>
      <p>All FIFA games found! You are all set! </p>
    <% else %>
      <p>Total number of FIFA games still needed: <%= @remaining_fifa_game %></p><br>
    <% end %>
    <br><br>
    <h1>Players list:</h1>
    <% @tournament.players.each do |player| %>
      <p>
        Username: <%= player.user.username %>
        <% if player.ps4 == true %>
          <p>Brings a PS4 console</p>
        <% else %>
          <p>Does not bring any console</p>
        <% end %>
        <% if player.controller_ps4 > 0 %>
          <p>Brings <%= player.controller_ps4 %> PS4 controller(s)</p>
        <% else %>
          <p>Does not bring any controller</p>
        <% end %>
        Brings <%= player.fifa_game_ps4 %> FIFA game(s)<br>
        <% @friends.each do |friend| %>
          <%= friend[:name] %>
        <% end %>



      </p>
    <% end %>
    <br>

  <% if @remaining != 0 && Player.where(tournament: @tournament, user: current_user).exists? == false %>
     <h1>Want to join?</h1>
    <%= simple_form_for [@tournament, @player] do |f| %>
    <!-- PS4 -->
    <p>Can you bring a console?</p>
    <p>PS4: <%= f.input :ps4, as: :radio_buttons, label: false, item_wrapper_tag: false  %> </p>
    <!-- buttons controllers PS4 -->
    <p>Can you bring a/a few PS4 controller(s)?</p>
    <%= f.input :controller_ps4, as: :radio_buttons, collection: 0..8, label: false, item_wrapper_tag: false %>
    <!-- fifa game -->
    <p>Can you bring a PS4 FIFA game?</p>
    <%= f.input :fifa_game_ps4, as: :radio_buttons, collection: 0..4, label: false, item_wrapper_tag: false %>
      <%= f.submit "Join" %>
    <% end %>
    <p>Sorry, this tournamment is closed for registration or you are already registered in this tournament</p>
  <% end %>


  <% if policy(@player).destroy? %>
    <%= link_to "Unregister from the tournament", tournament_player_path(@tournament, @current_player),
        method: :delete,
        data: { confirm: "Are you sure?" } %>
  <% end %>


  <% if policy(@tournament).destroy? %>
    <%= link_to "Delete the tournament", tournament_path(@tournament),
        method: :delete,
        data: { confirm: "Are you sure?" } %>
  <% end %>




<!-- Update Players info in the tournament -->
<% if Player.where(tournament: @tournament, user: current_user).exists? %>
  <h1>Want to add stuff?</h1>
  <% @player = Player.where(user: current_user, tournament: @tournament).first %>
   <%= simple_form_for [@tournament, @player] do |f| %>
    <!-- PS4 -->
    <p>Can you bring a console?</p>
    <p>PS4: <%= f.input :ps4, as: :radio_buttons, label: false, item_wrapper_tag: false  %> </p>
    <!-- buttons controllers PS4 -->
    <p>Can you bring a/a few PS4 controller(s)?</p>
    <%= f.input :controller_ps4, as: :radio_buttons, collection: 0..8, label: false, item_wrapper_tag: false %>
    <!-- fifa game -->
    <p>Can you bring a PS4 FIFA game?</p>
    <%= f.input :fifa_game_ps4, as: :radio_buttons, collection: 0..4, label: false, item_wrapper_tag: false %>
      <%= f.submit "Update" %>
    <% end %>
<% end %>
<!-- -->

<div id="map" style="width: 100%; height: 600px;"></div>

<% content_for(:after_js) do %>
  <%= javascript_tag do %>
    $(document).ready(function() {
      var handler = Gmaps.build('Google');
      handler.buildMap({ internal: { id: 'map' } }, function() {
        markers = handler.addMarkers(<%= raw @hash.to_json %>);
        handler.bounds.extendWith(markers);
        handler.fitMapToBounds();
        if (markers.length == 0) {
          handler.getMap().setZoom(2);
        } else if (markers.length == 1) {
          handler.getMap().setZoom(14);
        }
      });
    });
  <% end %>
<% end %>
